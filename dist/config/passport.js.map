{"version":3,"sources":["../../src/config/passport.js"],"names":["LocalStrategy","local","Strategy","passport","serializeUser","usuario","done","_id","deserializeUser","id","User","findById","err","use","usernameField","email","password","findOne","message","compararPassword","isEqual","estaAutenticado","req","res","next","isAuthenticated","status","send"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;;;AAEA,IAAMA,aAAa,GAACC,0BAAMC,QAA1B;;AAGAC,qBAASC,aAAT,CAAuB,UAACC,OAAD,EAASC,IAAT,EAAgB;AACnCA,EAAAA,IAAI,CAAC,IAAD,EAAMD,OAAO,CAACE,GAAd,CAAJ;AACH,CAFD;;AAIAJ,qBAASK,eAAT,CAAyB,UAACC,EAAD,EAAIH,IAAJ,EAAW;AAChCI,mBAAKC,QAAL,CAAcF,EAAd,EAAiB,UAACG,GAAD,EAAKP,OAAL,EAAe;AAC5BC,IAAAA,IAAI,CAACM,GAAD,EAAKP,OAAL,CAAJ;AACH,GAFD;AAGH,CAJD;;AAOAF,qBAASU,GAAT,CAAa,IAAIb,aAAJ,CACT;AAACc,EAAAA,aAAa,EAAC;AAAf,CADS,EAET,UAACC,KAAD,EAAOC,QAAP,EAAgBV,IAAhB,EAAuB;AACnBI,mBAAKO,OAAL,CAAa;AAACF,IAAAA,KAAK,EAALA;AAAD,GAAb,EAAqB,UAACH,GAAD,EAAKP,OAAL,EAAe;AAChC,QAAG,CAACA,OAAJ,EAAY;AACR,aAAOC,IAAI,CAAC,IAAD,EAAM,KAAN,EAAY;AAACY,QAAAA,OAAO,uBAAeH,KAAf;AAAR,OAAZ,CAAX;AACH,KAFD,MAEK;AACDV,MAAAA,OAAO,CAACc,gBAAR,CAAyBH,QAAzB,EAAkC,UAACJ,GAAD,EAAKQ,OAAL,EAAe;AAC7C,YAAGA,OAAH,EAAW;AACP,iBAAOd,IAAI,CAAC,IAAD,EAAMD,OAAN,CAAX;AACH,SAFD,MAEK;AACD,iBAAOC,IAAI,CAAC,IAAD,EAAM,KAAN,EAAY;AAACY,YAAAA,OAAO,EAAC;AAAT,WAAZ,CAAX;AACH;AACJ,OAND;AAOH;AACJ,GAZD;AAaH,CAhBQ,CAAb;;AAmBO,IAAMG,eAAe,GAAC,SAAhBA,eAAgB,CAACC,GAAD,EAAKC,GAAL,EAASC,IAAT,EAAgB;AACzC,MAAGF,GAAG,CAACG,eAAJ,EAAH,EAAyB;AACrB,WAAOD,IAAI,EAAX;AACH,GAFD,MAEK;AACDD,IAAAA,GAAG,CAACG,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,oDAArB;AACH;AACJ,CANM","sourcesContent":["import passport from 'passport';\r\nimport local from 'passport-local';\r\nimport User from '../models/User';\r\n\r\nconst LocalStrategy=local.Strategy;\r\n\r\n\r\npassport.serializeUser((usuario,done)=>{\r\n    done(null,usuario._id);\r\n});\r\n\r\npassport.deserializeUser((id,done)=>{\r\n    User.findById(id,(err,usuario)=>{\r\n        done(err,usuario);\r\n    })\r\n});\r\n\r\n\r\npassport.use(new LocalStrategy(\r\n    {usernameField:'email'},\r\n    (email,password,done)=>{\r\n        User.findOne({email},(err,usuario)=>{\r\n            if(!usuario){\r\n                return done(null,false,{message:`Este email ${email} no esta registrado`})\r\n            }else{\r\n                usuario.compararPassword(password,(err,isEqual)=>{\r\n                    if(isEqual){\r\n                        return done(null,usuario);\r\n                    }else{\r\n                        return done(null,false,{message:'La contraseÃ±a no es valida'})\r\n                    }\r\n                })\r\n            }\r\n        })\r\n    }\r\n));\r\n\r\nexport const estaAutenticado=(req,res,next)=>{\r\n    if(req.isAuthenticated()){\r\n        return next();\r\n    }else{\r\n        res.status(401).send('Tienes que hacer login para acceder a este recurso');\r\n    }\r\n}"],"file":"passport.js"}